---
title: "tool"
date: 2022-05-05T00:18:23+08:00
lastmod: 2022-05-05T00:18:23+08:00
author: ["Zain"]
keywords: 
- 
categories: 
- 
tags: 
- blog
- tool
description: ""  #描述
weight:  # 输入1可以顶置文章，用来给文章展示排序，不填就默认按时间排序
slug: ""
draft: true # 是否为草稿
comments: true
reward: true # 打赏
mermaid: true #是否开启mermaid
showToc: true # 显示目录
TocOpen: true # 自动展开目录
hidemeta: false # 是否隐藏文章的元信息，如发布日期、作者等
disableShare: true # 底部不显示分享栏
showbreadcrumbs: true #顶部显示路径
cover:
    image: "" #图片路径例如：posts/tech/123/123.png
    caption: "" #图片底部描述
    alt: ""
    relative: false
---



收藏
博客收藏
https://simowce.github.io/


PicGo: xclip not found! Please install xclip before run picgo.

PicGo: image not found in clipboard.

![pid_mark](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/pid_mark.png)


![Q](https://raw.githubusercontent.com/zhuangll/PictureBed/main/blogs/pictures/Q.gif)





内存检测王者之剑—valgrind
https://zhuanlan.zhihu.com/p/56538645/



哇，亲爱的弦鹅，     \
你好！哇，哇，，，        \
要说用不着自我介绍了吧？可是庸俗的人类竟然把我描绘成井底之蛙！燕雀不知鸿鹄之志，他们怎会明白我这与蛙不同的癞蛤蟆？   \
哇，哇，，，       \
青蛙只会吃，而我不仅有挣钱的本领，还会做诗填词，比如：    \
叶子无情地飘扬而去  \
不是    \
对风的追求   \
而是        \
树枝没有挽留。。。   \

天空在燃烧    \
大地在颤抖    \
一声惊雷        \
把蛤蟆等怕死鬼们     \
吓得屁滚尿流      \

只有我             \
在河边上          \
放开哇哇的歌喉       \

鹅鹅，哇，哇，，哇哇哇，，，，      \

我知道，这些年来你寻找我十分辛苦。     \
其实我也在梦中把你追求。         \
我在井旁寻觅，你在天边逗留。         \
我在田间傲视苍穹，你在天上鸟瞰九州。     \

十五的月亮照在地上也照在天边，       \
宁静的夜晚，你失眠我也失眠。     \
我边上班边钞股赚钱，          \
你翱翔在繁华闹市边。         \
我在电脑前紧张操盘，          \
你在咖啡厅里消遣。         \
哇哇期货帐里，            \ 
有我的甘甜，也有你的甘甜。      \
日元英镑                   \
有我的一半，也有你的一半。       \
哇~~~，也有你的一半。       \


鹅鹅，       \
哇，哇，，，      \

我知道你早已驰名中外，天鹅湖就为你而命名，比被我甩掉的那只大雁强多了。我真为你骄傲自豪。大雁她缺乏自知之明，跟我扬言说西安人专门为她造了大雁塔。其实，那是西安人的无知所犯的错。当然了，这些年来我也没闲着，蚊香的品牌以我命名。       \

鹅鹅，           \
哇，哇，，，        \

无知的人们说癞蛤蟆想吃天鹅肉，他们哪里知道美丽的天鹅都只爱癞蛤蟆？         \
社会学家发现每一只成功的天鹅背后都有一只聪明的癞蛤蟆.
所以，我愿意与你结成伉俪，天上地下都属于我们，让青蛙大雁们嫉妒去死吧！   \

鹅鹅，         \
哇，哇，，，      \


那些都是过去的事了。打从有了互联网，你在天上飞呀飞我在地上追呀追的日子一去不复返。        \
我要拼命地赚钱，就因为你喜欢钱。钞票给你带来的喜悦不亚于看到充满肌肉的蛤蟆腿美丽无瑕光滑浑圆。     \

然而，投机比投资风险大得多。 \

也许我的账号不能再打开，      \
转眼间钱飞烟灭不留残骸。   \
你是否理解你是否明白?        \
如果是这样，你不要悲哀，     \
共和国万亿储备中有我血染的风采。    \
也许我的股票被公司倒卖，        \
你是否理解你是否明白?         \
如果是这样，你不要悲哀，         \
共和国万亿储备里有我付出的爱。        \

鹅鹅，我亲爱的弦鹅，          \
哇，哇，，，                \

我与你谈钱，非常坦率。共和国允许一部分动物提前富起来。       \
有了钱，我们把暖气设备买来。我再也不需要冬眠，你再也不需要到南方避寒飞翔千里外。             \
有了钱，我们买下昂贵的蛤鹅健康保险，再也不担心成为人类的盘中餐，任凭他们杀宰。       \



盼望着你的回信。  \


真心爱着你的        \

癞蛤蟆      \



---- 摘自run
















[ARM Architecture Reference Manual Supplement®ARMv8.1, for ARMv8-A architecture profile](https://developer.arm.com/documentation/ddi0557/ab?lang=en)


[ARM Cortex -A Series®®Version: 1.0 Programmer’s Guide for ARMv8-A](https://developer.arm.com/documentation/den0024/a/?lang=en)



[ARM® Cortex®-A72 MPCore Processor Revision: r0p3 Technical Reference Manual](https://developer.arm.com/documentation/100095/0003/?lang=en)



















## 1.4 Cortex-A7处理器介绍

&ensp;树莓派4B开发板，内置了4个Cortex-A72处理器内核  <br>
&ensp;Cortex-A72处理器支持特性  <br>
- 采用ARMv8体系结构规范来设计，兼容ARMv8.0协议。
- 超标量处理器设计，支持乱序执行的流水线。
- 基于分支目标缓冲区（BTB）和全局历史缓冲区（GHB）的动态分支预测，返回栈缓冲器以及间接预测器。
- 支持48个表项的全相连指令TLB，可以支持4 KB、64 KB以及1 MB大小的页面。
- 支持32个表项的全相连数据TLB，可以支持4 KB、64 KB以及1 MB大小的页面。
- 每个处理器内核支持4路组相连的L2 TLB。
- 48 KB的L1指令高速缓存以及32 KB的L1数据高速缓存。
- 可配置大小的L2高速缓存，可以配置为512 KB、1 MB、2 MB以及4 MB大小。
- 基于AMBA4总线协议的ACE（AXI Coherency Extension）或者CHI（CoherentHubInterface）。
- 支持PMUv3体系结构的性能监视单元。
- 支持多处理器调试的CTI（Cross Trigger Interface）。
- 支持GIC（可选）。
- 支持多电源域（power domain）的电源管理。

![20221204175403](https://raw.githubusercontent.com/zainll/PictureBed/main/blogs/pictures/20221204175403.png)

#### 1.指令预取单元
&ensp;指令预取单元从L1指令高速缓存中获取指令，每个周期向译码单元最多发送3条指令。支持动态和静态分支预测，指令预取单元功能：
- L1指令高速缓存是一个48 KB大小、3路组相连的高速缓存，每个缓存行的大小为64字节。
- 支持48个表项的全相连指令TLB，可以支持4 KB、64 KB以及1 MB大小的页面。
- 带有分支目标缓冲器的2级动态预测器，用于快速生成目标。
- 支持静态分支预测。
- 支持间接预测。
- 返回栈缓冲器。

#### 2.指令译码单元
&ensp;指令译码单元对A32、T32、A64指令集进行译码   <br>
&ensp;指令译码单元执行寄存器重命名，消除写后写(WAW)和读后写(WAR)实现乱序执行   <br>

#### 3.指令分派单元

&ensp;指令分派单元控制译码后的指令何时被分派到执行管道及返回的结果何时终止，包括ARM核心通用寄存器、SIMD和浮点寄存器


#### 4.加载/存储单元

&ensp;加载/存储单元(LSU)执行加载和存储指令，包括L1数据存储系统


#### 5.L1内存子系统
&ensp;L1内存子系统包括指令内存系统和数据内存系统  <br>
&ensp;L1指令内存系统包括如下特性  <br>
- 具有48 KB的指令高速缓存，3路组相连映射。
- 缓存行的大小为64字节。
- 支持物理索引物理标记（PIPT）。
- 高速缓存行的替换算法为LRU（Least Recently Used）算法。
L
&ensp;L1数据内存系统包括如下特性  <br>
- 具有32 KB的数据高速缓存，两路组相连映射。
- 缓存行的大小为64字节。
- 支持物理索引物理标记。
- 对于普通内存，支持乱序发射、预测以及非阻塞的加载请求访问；对于设备内存，支持非预测以及非阻塞的加载请求访问。
- 高速缓存行的替换算法为LRU算法。
- 支持硬件预取。


#### 6.MMU
&ensp;MMU实现虚拟地址到物理地址转换，AArch64支持4KB、16KB、64KB页面  <br>
&ensp;MMMU包括：
- 48表项全相连的L1指令TLB
- 32表项全相连的L1数据TLB
- 4路组相连L2 TLB
  
&ensp;TLB支持8位或16位ASId，还支持VMID(虚拟化)


#### 7.L2内存子系统
&ensp;L2内存子系统不仅负责处理每个处理器内核的L1指令和数据高速缓存未命中的情况，还通过ACE或者CHI连接到内存系统。其特性  <br>
- 可配置L2高速缓存的大小，大小可以是512 KB、1 MB、2 MB、4 MB。
- 缓存行大小为64字节。
- 支持物理索引物理标记。
- 具有16路组相连高速缓存。
- 缓存一致性监听控制单元（Snoop Control Unit，SCU）。
- 具有可配置的128位宽的ACE或者CHI。
- 具有可选的128位宽的ACP接口。
- 支持硬件预取。


## 1.5 ARMv9体系结构

&ensp;ARMv9体系结构新加入的特性包括：  <br>
- 全新的可伸缩矢量扩展（Scalable Vector Extension version 2，SVE2）计算；
- 机密计算体系结构（Confidential Compute Architecture，CCA），基于硬件提供的安全环境来保护用户敏感数据；
- 分支记录缓冲区扩展（Branch Record Buffer Extension，BRBE），它以低成本的方式捕获控制路径历史的分支记录缓冲区；
- 内嵌跟踪扩展（Embedded Trace Extension，ETE）以及跟踪缓冲区扩展（Trace Buffer Extension，TRBE），用于增强对ARMv9处理器内核的调试和跟踪功能；
- 事务内存扩展（Transactional Memory Extension，TME）







# 第2章 搭建树莓派环境

## 2.1 树莓派
&ensp;树莓派4B 博通BCM2711芯片  <br>
- CPU内核：4核 A72 1.5GHz
- L1缓存： 32KB数据缓存，48KB指令缓存
- L2缓存： 1MB
- GPU： VideoCoreV1核心，500MHz
- 内存： LPDDR4 
  
&ensp;两种地址模式：
- 低地址模式
- 35位全地址模式


## 2.2 搭建树莓派环境

### 2.2.2 安装树莓派官方OS


&ensp;boot分区包括文件：
- bootcode.bin：引导程序
- start4.elf：树莓派4B的GPU固件
- start.elf： 树莓派3B的GPU固件
- config.txt：配置文件


### 2.2.4 使用GDB和QEMU虚拟机调试BenOS


## 2.3 BenOS代码


## 2.4 QEMU虚拟机与ARM64

&ensp;QEMU虚拟机与ARM64实验平台，书中Ubuntu20.04  <br>
&ensp;1)安装工具
```sh
sudo apt-get install qemu-system-arm libncurses5-dev gcc-aarch64-linux-gnu build-essential git bison flex libssl-dev

# 查看ARM gcc版本
aarch64-linux-gnu-gcc -v
```
&ensp;2)下载仓库
```sh
git clone git@github.com:figozhang/runninglinuxkernel_5.0.git
```
&ensp;3)编译内核及创建文件系统 <br>
&emsp;rootfs_arm64.tar.xz文件基于20.04系统的根文件系统创建
```sh
# 编译内核
cd runninglinuxkernel_5.0
./run_rlk_arm64.sh build_kernel

# 编译文件系统  生成rootfs_arm64.ext4根文件系统
cd runninglinuxkernel_5.0
sudo ./run_rlk_arm64.sh build_rootfs
```

&ensp;4)运行ARM64版本Linux系统
```sh
./run_rlk_arm64.sh run
# root   123
# 或
qemu-system-aarch64 -m 1024 -cpu max,sve=on,sev256=on -M virts
```

&ensp;5)在线安装软件包  <br>

```sh
# 查看网络配置
ifconfig 

```

&ensp;6)主机和QEMU虚拟机共享文件  <br>

```sh
cp test.c runninglinuxkernel_5.0/kmodules/

# qemu
cd /mnt
ls

```









# 第3章 A64指令集I ———— 加载与存储指令

&ensp;A64指令特点  <br>


## 3.1 A64指令集介绍

&ensp;ARMv8体系结构，A64指令集64位指令集，处理64位宽寄存器和数据，并使用64位指针访问内存，A64指令集指令宽度为32位  <br>
&ensp;A64指集分类：
- 内存加载和存在指令
- 多字节内存饺子和存储指令
- 算数和移位指令
- 移位操作指令
- 位操作指令
- 条件操作指令
- 跳转指令
- 独占内存访问
- 内存屏障指令
- 异常处理指令
- 系统寄存器访问指令

## 3.2 A64指令编码

&ensp;A64指令集指令宽度为32位，第24~28位识别指令分类


&ensp;op0字段值

<table>
	<tr>
	    <th>op0 字段值</th>
	    <th>说    明</th>
	</tr>
	<tr>
	    <td>0000x</td>
	    <td>保留</td>
    </tr>
    <tr>
	    <td>0010x</td>
	    <td>可伸缩矢量扩展(SVE)指令</td>
    </tr>
    <tr>
	    <td>100xx</td>
	    <td>数据处理指令(立即数)</td>
    </tr>
    <tr>
	    <td>101xx</td>
	    <td>分支处理指令、异常处理指令及系统寄存器访问指令</td>
    </tr>
    <tr>
	    <td>x1x0x</td>
	    <td>加载与存储指令</td>
    </tr>
    <tr>
	    <td>x101x</td>
	    <td>数据处理指令(基于寄存器)</td>
    </tr>
    <tr>
	    <td>x111x</td>
	    <td>数据处理指令(浮点数与SIMD)</td>
    </tr>
</table>


&ensp;加载与存储指令分类  <br>

&ensp;为什么指令编码宽度是32位？  <br>
&ensp;A64指令集基于寄存器加载和存储体系结构设计，数据加载、存储及处理在通用寄存器中。ARM64一共31个通用寄存器X0~X30，因此在指令编码中使用5位宽，可索引32个通用寄存器  <br>
- 使用寄存器作为基地址，把SP(栈指针)寄存器当做第31个通用寄存器
- 用作源寄存器操作数时，把XZR当作第31个通用寄存器



## 3.3 加载与存储指令






























